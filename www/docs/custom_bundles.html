<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Jawr - Definition of custom bundles</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <!-- TODO: move this into JavaScript to patch the skin
      <div class="xright">  </div>
    -->
    <div id="leftColumn">
      <div id="navcolumn">
             <dl class=navgroup>
        <dt>About</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Home</a>
        </li>
              
    <li class="none">
              <a href="../introduction.html">Introduction</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Documentation</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../docs/servlet.html">The Jawr servlet</a>
        </li>
              
    <li class="none">
              <a href="../docs/descriptor_syntax.html">Descriptor syntax</a>
        </li>
              
    <li class="none">
              <strong>Bundle definition</strong>
        </li>
              
    <li class="none">
              <a href="../docs/source_ordering.html">Source order in bundles</a>
        </li>
              
    <li class="none">
              <a href="../docs/postprocessors.html">Postprocessors</a>
        </li>
              
    <li class="none">
              <a href="../docs/license_files.html">Licenses in resources</a>
        </li>
              
    <li class="none">
              <a href="../docs/taglibs.html">Tag libraries</a>
        </li>
              
    <li class="none">
              <a href="../docs/modes.html">Debug and production modes</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Tutorials</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../tutorials/quickstart.html">Quick start</a>
        </li>
              
    <li class="none">
              <a href="../tutorials/libraries.html">Using popular libraries</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Project tools</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Project home</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMemberList">Membership</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectNewsList">Announcements</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectForumView">Discussion forums</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMailingListList">Mailing lists</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectDocumentList">Documents & files</a>
        </li>
              
    <li class="none">
              <a href="../source/browse/jawr/">Subversion</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectIssues">Issue tracker</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Project Documentation</dt>
        <dd><ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="../project-info.html">Project Information</a>
              </li>
              
                
              
      
            
      
              
        <li class="collapsed">
              <a href="../project-reports.html">Project Reports</a>
              </li>
          </ul></dd>
    </dl>
        </div>
      <script>
        // replace the java.net project tools with the navigation bar from Maven.
        // also get rid of "Get Involved" thingie too, while we are at it
        var pt = document.getElementById("projecttools");
        var nv = document.getElementById("navcolumn");
        
        while(pt.previousSibling!=null)
          pt.parentNode.removeChild(pt.previousSibling);
        
        pt.parentNode.insertBefore(nv,pt);
        pt.parentNode.removeChild(pt);
      </script>
      <script>
        // kill "description" h3 bar
        var ld = document.getElementById("longdescription");
        if(ld!=null) {
          for( n=ld.firstChild; n!=null; n=n.nextSibling ) {
            if(n.nodeType==1 && n.innerHTML=="Description" ) {
              n.parentNode.removeChild(n);
              break;
            }
          }
        }
      </script>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Definition of custom bundles</h2><p>Bundles are the core functionality of Jawr. A bundle is a group of resources joined together in a single file that has an associated logical name. Thus, to create a bundle the bare minimum you will need is a name and a group of resources. For instance, the following lines in your descriptor file would create a bundle named /bundles/fooBundle.js: </p><div class="source"><pre>        jawr.js.bundle.names=foo        
        jawr.js.bundle.foo.id=/bundles/fooBundle.js
        jawr.js.bundle.foo.mappings=/js/foo.js, /js/bar.js</pre></div><p>The newly created bundle would be the union of foo.js and bar.js. Once created, you could then use any of three ways to import the whole bundle to your pages: </p><div class="source"><pre>        Id of the bundle:
        &lt;jwr:script src=&quot;/bundles/fooBundle.js&quot;/&gt; 
        
        Path to foo.js: 
        &lt;jwr:script src=&quot;/js/foo.js&quot;/&gt; 
        
        Path to bar.js
        &lt;jwr:script src=&quot;/js/bar.js&quot;/&gt; </pre></div><p>As you can see, a bundle can be invoked by using either its id or the path to any of its members. The page link rendered will be the same in all the three sample cases:</p><div class="source"><pre>&lt;script type=&quot;text/javascript&quot; src=&quot;/myWarContext/prefix/bundles/fooBundle.js&quot; &gt;&lt;/script&gt;</pre></div><p>Normally, it would be a best practice to use the resource names directly, since: </p><ul><li>By using a resource name, you will later be able to change your bundles according to real life usage of your site, without the need to change your pages. </li><li>Using the resource name will make it explicit to other developers which parts of the code you are using. </li></ul><p>This holds true even if you use several members of a bundle on the same page. Jawr will only include the same bundle once per page, even when several tags match it. On the other hand, if a bundle conveys a single general functionality (such as validation), then it is probably best to invoke it by id. &#160;</p><p>It is recommended that you use a virtual prefix for bundle ids (such as '/bundles/'). The prefix should not correspond to any actual directory in the root resources dir, to avoid namespace collisions.</p><div class="section"><h3>Mapping resources</h3><p>There are three ways to map resources: </p><ul><li>Directly by resource path: simply type the relative path to the resource, starting at the root of the WAR file, as in: '/js/foo.js'. </li><li>By directory, non-recurring: add the path to a directory and every resource under it will be added to the bundle, as in: '/js/'. </li><li>By directory, recurring: same as before but adding '**' at the end. This will add every resource under the specified directory <b>and</b> any directory below it. For example: '/js/**'. </li></ul><p>You can add any combination of the three types of mapping to your bundles. for instance, let's add another bundle to the previous example. We will name this bundle /bundles/bazBundle.js. It will contain every file under /js/baz/ and any of its subdirs, a script located at /js/someScript.js, and every file directly under /js/someSubdir/. </p><div class="source"><pre>        jawr.js.bundle.names=foo, baz   
        
        jawr.js.bundle.foo.id=/bundles/fooBundle.js
        jawr.js.bundle.foo.mappings=/js/foo.js, /js/bar.js
        
        jawr.js.bundle.baz.id=/bundles/bazBundle.js
        jawr.js.bundle.baz.mappings=/js/baz/**, /js/someScript.js, /js/someSubdir/              </pre></div><p>For details on how the resources are ordered within the bundle, refer to the <a href="./source_ordering.html">source ordering manual page</a>. </p></div><div class="section"><h3>Global bundles</h3><p>Global bundles are useful for including common libraries and modules used throughout you site. Any bundle defined as global will always be included before any other bundle. Most of the time you will not need to explicitly invoke it since Jawr will automatically include all global bundles before any particular bundle in a page. So when you add a link to whichever bundle in your page, links will be created to all global bundles and then one more for the bundle you specified. &#160;</p><p>To define a global bundle you would do as follows: </p><div class="source"><pre>        jawr.js.bundle.names=foo, baz, lib      
        
        ...     
        jawr.js.bundle.lib.id=/lib.js
        jawr.js.bundle.lib.mappings=/js/lib/**
        jawr.js.bundle.lib.global=true
        jawr.js.bundle.lib.order=1</pre></div><p>We set the global parameter to true and then we specified an order number. The order value is only needed if you define more than one global bundle and you need a specific order of inclusion. </p></div><div class="section"><h3>Bundle prefix</h3><p>Every HTML link that Jawr creates has a section of its path dedicated to versioning. Jawr will serve its resources using aggressive caching headers, in order to keep clients from requesting the same bundle over and over. But, when you make changes you want to be sure that every client will download the new version. Thus, the best way to do this is to actually change the URL for the resource whenever the resource changes. &#160;</p><p>In the configuration file you will specify a default prefix which will be applied to every bundle. However, some of your bundles will not change with every new deployment of your application. For instance, open source libraries will not change until you upgrade them, which will not happen so many times. Thus, for every bundle you define in the descriptor you can specify its prefix, which will override the default one. That way you will have increased control over which resources need to be re-downloaded by application clients. Normally, a prefix will convey some kind of version number. Here is an example: </p><div class="source"><pre>        jawr.js.bundle.names=foo, baz, lib      
        
        ...     
        jawr.js.bundle.lib.id=/lib.js
        jawr.js.bundle.lib.mappings=/js/lib/**
        jawr.js.bundle.lib.global=true
        jawr.js.bundle.lib.order=1
        jawr.js.bundle.lib.prefix=lib_002</pre></div><p><b>WARNING</b>: the most important thing you must keep in mind when using Jawr is to always remember to change this prefix when a bundle changes. If you put in production a new version of your files without changing the prefix, your clients will NOT download the newer version. This is the only drawback of a strict caching policy that, if used properly, will improve your users experience of the site while lowering the bandwith. </p></div><div class="section"><h3>Postprocessors </h3><p>Postprocessors are filters that Jawr applies to resources and bundles during startup. Check the <a href="./postprocessors.html">postprocessors manual page</a> for more info. &#160;</p><p>Each bundle you define can override the global postprocessing options. This is useful for example if you only want to minify a subset of your files. </p><p>To change the global postprocessor chain for a bundle, specify the <b>bundlepostprocessors</b> and/or the <b>filepostprocessors</b> attribute: </p><div class="source"><pre>
        jawr.js.bundle.foo.bundlepostprocessors=license
        jawr.js.bundle.foo.fileprocessors=none
        </pre></div><p>In this example, the bundle postprocessor for the <i>foo</i> bundle is set to <i>license</i>, meaning no minification will occur. And for the file-by-file postprocessor, it is specified that none will be used. </p></div><div class="section"><h3>Composite bundles</h3><p>A composite bundle is made up of several bundles that may have different configuration attributes. For example, you might have a pre minified javascript library and need to bundle it along some of your own scripts. You can could then create a composite bundle in which your scripts are minified but the library is not. &#160;</p><p>Another use case for composites is to have part of a bundle appear in debug mode but not in production, such as loggers and the like. &#160;</p><p>Creating a composite is just like creating any other bundle, only instead of the mappings, you specify the child bundles that make the composite up using the <b>child.names</b> attribute. You also need to specify that the bundle is a composite by setting the <b>composite</b> attribute to true: </p><div class="source"><pre>jawr.js.bundle.names=comp

jawr.js.bundle.comp.id=/bundles/composite.js
jawr.js.bundle.comp.global=true
jawr.js.bundle.comp.composite=true
jawr.js.bundle.comp.prefix=comp_001

jawr.js.bundle.comp.child.names=foo, bar
</pre></div><p>For this composite, we declared two children: <i>foo</i> and <i>bar</i>. The child bundles for a composite differ from normal bundles in that they do not need an id or prefix, and they cannot be declared as global. Otherwise, every other attribute can be specified individually, such as postprocessors and the <b>debugnever</b> and <b>debugonly</b> attributes: </p><div class="source"><pre>        
        jawr.js.bundle.foo.mappings=/js/foo.js, /js/bar.js
        jawr.js.bundle.foo.debugnever=true
        
        jawr.js.bundle.bar.mappings=/js/baz/**, /js/someScript.js, /js/someSubdir/              
        jawr.js.bundle.bar.bundlepostprocessors=none
        </pre></div><p>With such mapping, we specify that, when in development mode, the composite will not contain the files mapped by the <i>foo</i> bundle, and that the <i>baz</i> bundle will not use any postprocessor even if there were globally defined ones. </p></div><div class="section"><h3>Orphan resources</h3><p>In Jawr terminology, orphan resources are those not mapped to any bundle after initial configuration. For instance, if you do not define any bundle at all, then <b>all</b> your resources will be orphan. This isn't necesarily a bad thing: sometimes you will want to serve standalone resources instead of bundles ones, and creating an explicit mapping for each would be very verbose. &#160;</p><p>That said, Jawr will need to take care of serving orphan files. You can configure it to do one of two things: </p><ul><li><b>Create one-file bundles with each orphan resource</b>: This is what Jawr will do by default. The generated bundles will have a name equal to the path to the resource and they will benefit from the same postprocessing scheme (minification, etc) as any regular bundle. &#160;<p>If the path of an orphan file accidentally matches the name of any of your bundles an exception will be thrown since bundles can not share the same path. Therefore it is recommended to reserve some namespace prefix for bundles, such as /bundles/. </p></li><li><b>Join all orphan files into a single bundle</b>: This is useful if you want to just put all your resources into a single file. In this case your configuration file will be very simple since you will not need to define any bundle at all. The only thing you need to do to use this feature is to activate it in you configuration and to set the name for the <i>all-in-one</i> bundle: <div class="source"><pre>        
        # For js resources. CSS is the same but properties start with jawr.css.*
        jawr.js.factory.use.singlebundle=true
        
        # Use any name you want
        jawr.js.factory.singlebundle.bundlename=/bundles/allInOne.js
        </pre></div><p>Note that you may actually define some bundles and then use this feature if that suits you. Also, the usual ordering scheme will apply to the orphans bundle. Check the <a href="./source_ordering.html">source ordering manual</a> for more info. &#160;</p></li></ul></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2007
    
          
  

  
  
  &nbsp;| Last Published: 12/21/2007
  &nbsp;| Version: 1.0
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
