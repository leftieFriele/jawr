<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Jawr - ResourceBundle to i18n javascript messages</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <!-- TODO: move this into JavaScript to patch the skin
      <div class="xright">  </div>
    -->
    <div id="leftColumn">
      <div id="navcolumn">
             <dl class=navgroup>
        <dt>About</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Home</a>
        </li>
              
    <li class="none">
              <a href="../introduction.html">Introduction</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Documentation</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../docs/servlet.html">The Jawr servlet</a>
        </li>
              
    <li class="none">
              <a href="../docs/descriptor_syntax.html">Descriptor syntax</a>
        </li>
              
    <li class="none">
              <a href="../docs/custom_bundles.html">Bundle definition</a>
        </li>
              
    <li class="none">
              <a href="../docs/source_ordering.html">Source order in bundles</a>
        </li>
              
    <li class="none">
              <a href="../docs/postprocessors.html">Postprocessors</a>
        </li>
              
    <li class="none">
              <a href="../docs/license_files.html">Licenses in resources</a>
        </li>
              
    <li class="none">
              <a href="../docs/taglibs.html">JSP Tag library</a>
        </li>
              
    <li class="none">
              <a href="../docs/plain_html.html">Use in HTML pages</a>
        </li>
              
    <li class="none">
              <a href="../docs/modes.html">Debug and production modes</a>
        </li>
              
    <li class="none">
              <strong>i18n message generator</strong>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Integration</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../integration/facelets.html">Facelets Tag library</a>
        </li>
              
    <li class="none">
              <a href="../integration/grails.html">Grails plugin</a>
        </li>
              
    <li class="none">
              <a href="../integration/dwr.html">DWR</a>
        </li>
              
    <li class="none">
              <a href="../integration/validator.html">Commons Validator - Struts</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Tutorials</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../tutorials/quickstart.html">Quick start</a>
        </li>
              
    <li class="none">
              <a href="../tutorials/faq_howto.html">FAQ-Howto</a>
        </li>
              
    <li class="none">
              <a href="../tutorials/libraries.html">Using popular libraries</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>API and sources</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../nonav/apidocs/index.html">JavaDocs</a>
        </li>
              
    <li class="none">
              <a href="../nonav/xref/index.html">Source XREF</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Project tools</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Project home</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMemberList">Membership</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectNewsList">Announcements</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectForumView">Discussion forums</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMailingListList">Mailing lists</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectDocumentList">Documents & files</a>
        </li>
              
    <li class="none">
              <a href="../source/browse/jawr/">Subversion</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectIssues">Issue tracker</a>
        </li>
          </ul></dd>
    </dl>
        </div>
      <script>
        // replace the java.net project tools with the navigation bar from Maven.
        // also get rid of "Get Involved" thingie too, while we are at it
        var pt = document.getElementById("projecttools");
        var nv = document.getElementById("navcolumn");
        
        while(pt.previousSibling!=null)
          pt.parentNode.removeChild(pt.previousSibling);
        
        pt.parentNode.insertBefore(nv,pt);
        pt.parentNode.removeChild(pt);
      </script>
      <script>
        // kill "description" h3 bar
        var ld = document.getElementById("longdescription");
        if(ld!=null) {
          for( n=ld.firstChild; n!=null; n=n.nextSibling ) {
            if(n.nodeType==1 && n.innerHTML=="Description" ) {
              n.parentNode.removeChild(n);
              break;
            }
          }
        }
      </script>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Javascript i18n message generator</h2><p>For any given rich application, chances are that many messages will be handled and displayed by javascript components. On the other hand, java web applications have always supported internationalization by means of ResourceBundles. Messages are stored in properties files which are versioned to different languages and stored using a file naming scheme that uses a base name for the ResourceBundle (such as 'messages') and suffixes that specify the different locales supported (such as 'messages_es' for spanish). </p><p>There are a number of tag libraries (including JSTL) that support the use of such messages in JSP pages, but in order to use these messages in javascript there isn't a practical solution for transfering all messages to js variables. The messages generator in Jawr will do just that, generating automatically a javascript data structure that closely resembles the properties format. Each property is converted to a function that returns the message, supporting variable substitution with the standard ResourceBundle format. For example, if you message properties file (which could be names jsmessages.properties) contains the following messages: </p><div class="source"><pre>    main.hello.world=Hello world!
    main.user.salutation=Welcome, {0}!</pre></div><p>By using a generator, you will be able to access the messages from javascript like this: </p><div class="source"><pre>        alert( messages.main.hello.world() );
        alert( messages.main .user.salutation('John') );        </pre></div><p>The previous script would display two consecutive alert messages, showing the texts 'Hello world!' and 'Welcome, John!'. </p><p>Each bundle containing a messages generator can declare language variants, so Jawr will include a language specific version of the messages script for any given user. Continuing with the last example, if you had a jsmessages_es.properties file with spanish messages, such as the following: </p><div class="source"><pre>    main.hello.world=Hola mundo!
    main.user.salutation=Bienvenido, {0}!</pre></div><p>For any user using the es_ES locale, the bundle will contain the messages from this file rather than the ones in english. This way the scripts which access the properties will receive the spanish version messages. The way the locale is customizable to suit any application specific way of defining the language. </p><div class="section"><h3>Mapping a message generator</h3><p>Message bundles are defined as mappings within a bundle, using a special syntax. Additionally, each language variant we want to use must be declared. A simple mapping would look as this: </p><div class="source"><pre>    jawr.js.bundle.names=lib

    jawr.js.bundle.lib.id=/bundles/global.js
    jawr.js.bundle.lib.mappings=messages:com.myapp.jsmessages,/js/lib/**
    jawr.js.bundle.lib.locales=es</pre></div><p>As you can see, a mapping was added to 'messages:com.myapp.jsmessages'. All mappings to message bundles will start with 'messages:', followed by a comma separated list of the basenames for the ResourceBundles. In this case, the mapping refers to properties files located in the classpath under 'com/myap' with the name 'jsmessages.properties'. </p><p>The property 'jawr.js.bundle.lib.locales' defines the variants for this bundle, which in this case defines a spanish language variant. In this example, Jawr will resolve properties located at 'com/myapp/jsmessages_es.properties' for this locale. Note that the default english locale does not need to be defined, since it will be used by default if the user's locale does not match any of the defined variants. Note that this depends on the server's default locale. Also note that variants do not need to overwrite every property defined in the base locale messages file. The non overwritten properties will be read from the base file (which is the normal behavior when using java ResourceBundles). </p><div class="section"><h4>Defining the message namespace. </h4><p>You probably noticed that in the previous example, when referencing the messages from javascript the properties were referenced using the name of the property preceded by 'messages.'. Jawr will by default define a 'messages' variable and add all properties as attributes for this variable. 'foo.bar' is going to be referenced always as 'messages.foo.bar()'. This is done so in order to avoid polluting the javascript properties namespace: imagine you had a function named foo() and a property named foo.hello: there would be a collision between the two names. </p><p>You can change the name used for the messages namespace to whatever you want. You will need to do it if you use two generators in the same page, because otherwise the messages namespace for the second generator will overwrite the firt one's. So if you have a general messages ResourceBundle and you use others for page specific messages, you should declare those with a different namespace. </p><p>To define a namespace you enclose it in parentheses and add it to the end of the mapping: </p><div class="source"><pre>    jawr.js.bundle.lib.mappings=messages:com.myapp.messages(mynamespace),/js/lib/**    </pre></div><p>With this mapping, you would acces the 'hello.world' message using 'mynamespace.hello.world()'. </p></div><div class="section"><h4>Filtering messages. </h4><p>If you have each and every message for your application defined in a single ResourceBundle, it might be inpractical to pass all the messages to javascript, since many will never be used. In this case, you can specify a name filter (such as javascript.messages) so that only properties for which the name starts with the filter are passed to javascript. To do that you enclose the filter in brackets and add it to the end of the mapping: </p><div class="source"><pre>    jawr.js.bundle.lib.mappings=messages:com.myapp.messages[javascript.messages],/js/lib/**    </pre></div><p>With this mapping, only the properties having a key that starts with javascript.messages (like 'javascript.messages.hello.world=Hello world!') will be included in the generated javascript. </p><p>If you define both a namespace and a filter, remember that the filter needs to be defined after the namespace: </p><div class="source"><pre>    jawr.js.bundle.lib.mappings=messages:com.myapp.messages(mynamespace)[javascript.messages],/js/lib/**    </pre></div></div><div class="section"><h4>Locale resolution. </h4><p>There is not a universal way to determine which Locale to use for a given user. Many applications roll their own, so Jawr has a way to plug in a component to take care of custom Locale resolution strategies. Normally Jawr will use the request.getLocale() method to find out the user's Locale. If your app has different needs, you will have to create a class that implements a simple interface (net.jawr.web.resource.bundle.locale.LocaleResolver). This interface defines a single method: </p><div class="source"><pre>   public abstract String resolveLocaleCode(HttpServletRequest request);  </pre></div><p>Your implementation will take the request, determine the user's locale an return its String representation. Jawr will take care of the rest. To plug in your class, you will define it in the properties file under the key jawr.locale.resolver: </p><div class="source"><pre>   jawr.locale.resolver=com.mypackage.myapp.MyLocaleResolverImplementation</pre></div><p>Your class will be instantiated using reflection, so make sure it has a public default no-arg constructor. </p></div><div class="section"><h4>Grails usage. </h4><p>Grails users do not need to implement the LocaleResolver interface, since the default strategy used by Grails will be leveraged by Jawr. Keep in mind that the default cualified name for the Grails Resourcebundle is grails-app.i18n.messages, so map accordingly: </p><div class="source"><pre>    jawr.js.bundle.lib.mappings=messages:grails-app.i18n.messages</pre></div></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2008
    
          
  

  
  
  &nbsp;| Last Published: 07/08/2008
  &nbsp;| Version: 2.4.2
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
