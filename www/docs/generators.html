<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">











<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Jawr - Generators</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <div id="banner">
                    <span id="bannerLeft">
    
            Java web resources bundling and compression
    
            </span>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
    
            <div class="xleft">
        Last Published: 2008-11-25
                      </div>
            <div class="xright">      
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
    
                   <h5>About</h5>
            <ul>
              
    <li class="none">
                    <a href="../servlets/ProjectHome">Home</a>
          </li>
              
    <li class="none">
                    <a href="../introduction.html">Introduction</a>
          </li>
              
    <li class="none">
                    <a href="../features.html">Features</a>
          </li>
              
    <li class="none">
                    <a href="../changes.html">Change history</a>
          </li>
          </ul>
              <h5>Documentation</h5>
            <ul>
              
    <li class="none">
                    <a href="../docs/servlet.html">The Jawr servlet</a>
          </li>
              
    <li class="none">
                    <a href="../docs/descriptor_syntax.html">Descriptor syntax</a>
          </li>
              
    <li class="none">
                    <a href="../docs/custom_bundles.html">Bundle definition</a>
          </li>
              
    <li class="none">
                    <a href="../docs/source_ordering.html">Source order in bundles</a>
          </li>
              
    <li class="none">
                    <a href="../docs/postprocessors.html">Postprocessors</a>
          </li>
              
    <li class="none">
              <strong>Generators</strong>
        </li>
              
    <li class="none">
                    <a href="../docs/license_files.html">Licenses in resources</a>
          </li>
              
    <li class="none">
                    <a href="../docs/taglibs.html">JSP Tag library</a>
          </li>
              
    <li class="none">
                    <a href="../docs/plain_html.html">Use in HTML pages</a>
          </li>
              
    <li class="none">
                    <a href="../docs/modes.html">Debug and production modes</a>
          </li>
              
    <li class="none">
                    <a href="../docs/messages_gen.html">i18n message generator</a>
          </li>
          </ul>
              <h5>Integration</h5>
            <ul>
              
    <li class="none">
                    <a href="../integration/augmenter.html">Add Jawr to your framework</a>
          </li>
              
    <li class="none">
                    <a href="../integration/spring.html">Spring MVC</a>
          </li>
              
    <li class="none">
                    <a href="../integration/facelets.html">Facelets Tag library</a>
          </li>
              
    <li class="none">
                    <a href="../integration/grails.html">Grails plugin</a>
          </li>
              
    <li class="none">
                    <a href="../integration/dwr.html">DWR</a>
          </li>
              
    <li class="none">
                    <a href="../integration/validator.html">Commons Validator - Struts</a>
          </li>
          </ul>
              <h5>Tutorials</h5>
            <ul>
              
    <li class="none">
                    <a href="../tutorials/quickstart.html">Quick start</a>
          </li>
              
    <li class="none">
                    <a href="../tutorials/faq_howto.html">FAQ-Howto</a>
          </li>
              
    <li class="none">
                    <a href="../tutorials/libraries.html">Using popular libraries</a>
          </li>
          </ul>
              <h5>API and sources</h5>
            <ul>
              
    <li class="none">
                    <a href="../nonav/apidocs/index.html">JavaDocs</a>
          </li>
              
    <li class="none">
                    <a href="../nonav/xref/index.html">Source XREF</a>
          </li>
          </ul>
              <h5>Project tools</h5>
            <ul>
              
    <li class="none">
                    <a href="../servlets/ProjectHome">Project home</a>
          </li>
              
    <li class="none">
                    <a href="../servlets/ProjectMemberList">Membership</a>
          </li>
              
    <li class="none">
                    <a href="../servlets/ProjectNewsList">Announcements</a>
          </li>
              
    <li class="none">
                    <a href="../servlets/ProjectForumView">Discussion forums</a>
          </li>
              
    <li class="none">
                    <a href="../servlets/ProjectMailingListList">Mailing lists</a>
          </li>
              
    <li class="none">
                    <a href="../servlets/ProjectDocumentList">Documents & files</a>
          </li>
              
    <li class="none">
                    <a href="../source/browse/jawr/">Subversion</a>
          </li>
              
    <li class="none">
                    <a href="../servlets/ProjectIssues">Issue tracker</a>
          </li>
          </ul>
                                           <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img alt="Built by Maven" src="../images/logos/maven-feather.png"></img>
          </a>
                       
  

  
    
  
  
    
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Jawr Generators</h2>
<p>In some cases it is convenient to generate scripts or CSS dynamically. For instance, Jawr will create certain scripts to, say, copy i18n messages from a ResourceBundle over to a special script. You may need to retrieve some data from a database and create parameters that scripts will need, or simply grab parameters from a configuration file and pass them over to the scripting context. For any case where you may need to generate content you can implement a ResourceGenerator and register it in Jawr to suit your needs. &#160;</p>
<p>Note that a ResourceGenerator is <b>not</b>
 a <i>script servlet</i>
: it will be only invoked once during application startup. The result of this invocation will be added to whichever bundle you decide and reused until the next redeployment. The point is to be able to generate some script dynamically but still to be able to minify it and add it to your bundles. A perfect example is the DWR generator: all DWR script interfaces are created from java classes once during startup but they can be minified and bundled together. </p>
<div class="section"><h3>Using a generator</h3>
<p>Generators are mapped to bundles as if they were regular script or CSS files, only using a special syntax: </p>
<div class="source"><pre>        prefix:path(params)[params]</pre>
</div>
<p>The prefix is a key you will specify when implementing the Generator, and the path is a string which will have different meaning depending on your generator's functionality. Also, you have params in parentheses and in brackets (both of which are optional), that further help in parameterizing the mappings. A simple mapping example, with no params, is as follows: </p>
<div class="source"><pre>        jawr.js.bundle.one.mappings=jar:net/jawr/cpscript.js</pre>
</div>
<p>In this case we are using the already existing classpath script generator, which reads a script from the classpath, as opposed to reading it from the web application dir structure. So the path in this case is the classpath where the script will be found. The prefix is 'jar', which lets Jawr know that this path must be resolved using the classpath generator. </p>
<p>This is an example in which the mapping uses two different parameters: </p>
<div class="source"><pre>        jawr.js.bundle.one.mappings=messages:com.myapp.messages(mynamespace)[javascript.messages]</pre>
</div>
<p>Note that if you use the parameters, the order must always be paraentheses firs, brackets last. If you need only one parameter, you can omit the brackets param. </p>
</div>
<div class="section"><h3>Jawr generators</h3>
<p>Jawr comes with several generators, each accomplishing a special kind of task. The currently provided generators are: </p>
<ul><li><b>i18n messages script generator</b>
: generates javascript code with locale specifica variants which are loaded depending on the user's specific language. Full documentation is <a href="./messages_gen.html">here</a>
. </li>
<li><b>DWR scripts generator</b>
: allows you to bundle and compress together DWR generated interfaces, plus all the utility scripts required by them. Full documentation is <a href="../integration/dwr.html">here</a>
. </li>
<li><b>Commons Validator generator</b>
: this one will let you generate compressed and cacheable versions of the validation scripts generated in Struts by the Apache Commons Validator taglib. Full docs <a href="../integration/validator.html">here</a>
. </li>
</ul>
<p>Also available is the <b>classpath resource generator</b>
. It allows you to include resources present within jar files or simply located anywhere in the application classpath. You will need to use different prefixes if you are generating js or css files. To add javascript resources from the classpath you use <b>jar:</b>
 as the prefix, followed by the path to the resource using / as separator: </p>
<div class="source"><pre>        jawr.js.bundle.names=foo, baz   
        
        jawr.js.bundle.foo.id=/bundles/fooBundle.js
        # Map to a script in the com.mycompany.myapp package and to another from the WAR 
        jawr.js.bundle.foo.mappings=jar:/com/mycompany/myapp/foo.js, /js/bar.js
        </pre>
</div>
<p>Note the leading slash in the mapping, which is also required. You can of course combine this kind of mappings with regular ones, so you can bundle together resources from the WAR and from the classpath. </p>
<p>If you need to load CSS files from the classpath, you would use the exact same syntax, only changing the prefix from <b>jar:</b>
 to <b>jar_css:</b>
 </p>
<div class="source"><pre>        jawr.css.bundle.styles.mappings=jar_css:/com/mycompany/myapp/stylesheet.css, /css/bar.css       </pre>
</div>
<p>Unlike the normal mapping, this way of referring to resources does not yet allow wildcards (i.e.: <i>jar:/com/mycompany/myapp/**</i>
 would not work). </p>
</div>
<div class="section"><h3>Implementing a generator</h3>
<p>A generator is an implementation of the interface net.jawr.web.resource.bundle.generator.ResourceGenerator. This is a simple interface which exposes three methods: </p>
<ul><li>public Reader createResource(GeneratorContext context);</li>
<li>public String getMappingPrefix();</li>
<li>public String getDebugModeRequestPath();</li>
</ul>
<p>The getDebugModeRequestPath simply returns a path to be used in debug mode. This is simply a fake script or CSS name and it really has no importance unless you are mapping the Jawr servlet to a suffix different from *.css or .js. 99% of the use cases don't need to care about this so you can simply return one of two constants: ResourceGenerator.JAVASCRIPT_DEBUGPATH or ResourceGenerator.CSS_DEBUGPATH: </p>
<div class="source"><pre>public String getDebugModeRequestPath() {
        return ResourceGenerator.JAVASCRIPT_DEBUGPATH;
}</pre>
</div>
<p>The getMappingPrefix() method returns a key you will use when mapping you generator to bundles. Jawr will recognize this key in the bundle mappings and use your generator when it applies. So, if you returned 'foo' in this method, you would map your generator like this: </p>
<div class="source"><pre>        jawr.js.bundle.one.mappings=foo:somePath</pre>
</div>
<p>Finally, the createResource() method is where the actual generation takes place. This method takes a single parameter of type GeneratorContext, which contains all the information you need to build a dynamic script or CSS. The useful methods are: </p>
<ul><li>getPath(): this contains the mapping, without the prefix and parameters. For instance, in a mapping of the form 'prefix:thePath(param)', this method returns 'thePath'. </li>
<li>getConfig(): returns the JawrConfig object used throughout the application. It contains data about the Jawr configuration, such as wether debug mode is on or off, the current servlet mapping, and so on. </li>
<li>getCharset(): returns the current charset, which the returned script or CSS must conform to. </li>
<li>getServletContext(): returns the application's ServletContext. </li>
<li>getParenthesesParam(): returns the params in parentheses, if any were declared. For instance, in a mapping such as 'foo:path(aParam)', this would return 'aParam'. </li>
<li>getBracketsParam(): returns the params in brackets, if any were declared. For instance, in a mapping such as 'foo:path(aParam)[anotherParam], this would return 'anotherParam'.<p>Using this information, you should be able to generate a script or CSS and return in in the form of a Reader object (typically a StringReader is sufficient for the task). </p>
</li>
</ul>
</div>
<div class="section"><h3>Mapping a generator</h3>
<p>Once you have your Generator implemented, you need to register into Jawr in order to use it. This is simply a matter of mapping its classname in the configuration properties file under the key 'jawr.custom.generators'. If there is more than one, you simply declare them separated by commas: </p>
<div class="source"><pre>        jawr.custom.generators=com.mycompany.myapp.MyCustomGeneratorImplementation,com.mycompany.myapp.AnotherGenerator</pre>
</div>
</div>
<div class="section"><h3>A simple example: an alert message generator</h3>
<p>Here is a sample class which you can use to get started. It simply creates a script that displays an alert message with whichever text is used as the path in the mapping: </p>
<div class="source"><pre>package net.jawr.example;

        public class TestGenerator implements ResourceGenerator {

        public Reader createResource(GeneratorContext context) {
                
                return new StringReader(&quot;;alert('Mapping contained:&quot; + context.getPath() +  &quot;');&quot;);
        }

        public String getMappingPrefix() {
                return &quot;example&quot;;
        }
        
        public String getDebugModeRequestPath() {
                return ResourceGenerator.JAVASCRIPT_DEBUGPATH;
        }
}</pre>
</div>
<p>With this class in hand, we first register it in our properties config file: </p>
<div class="source"><pre>        jawr.custom.generators=net.jawr.example.TestGenerator</pre>
</div>
<p>And now it's a matter of creating a bundle and use the generator: </p>
<div class="source"><pre>        jawr.js.bundle.names=global
        jawr.js.bundle.global.id=/bundles/global.js
        jawr.js.bundle.global.mappings=example:Hello World!,example:And Hello Again!</pre>
</div>
<p>And that's it, now add the bundle to any page and when it's loaded, you should get an alert box with the text 'Mapping contained:Hello World!' followed by a second alert box with the text 'Mapping contained:And Hello Again!'. </p>
</div>
</div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2008
    
          
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
