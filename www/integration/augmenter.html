<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Jawr - Integrating Jawr in a framework</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <!-- TODO: move this into JavaScript to patch the skin
      <div class="xright">  </div>
    -->
    <div id="leftColumn">
      <div id="navcolumn">
             <dl class=navgroup>
        <dt>About</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Home</a>
        </li>
              
    <li class="none">
              <a href="../introduction.html">Introduction</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Documentation</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../docs/servlet.html">The Jawr servlet</a>
        </li>
              
    <li class="none">
              <a href="../docs/descriptor_syntax.html">Descriptor syntax</a>
        </li>
              
    <li class="none">
              <a href="../docs/custom_bundles.html">Bundle definition</a>
        </li>
              
    <li class="none">
              <a href="../docs/source_ordering.html">Source order in bundles</a>
        </li>
              
    <li class="none">
              <a href="../docs/postprocessors.html">Postprocessors</a>
        </li>
              
    <li class="none">
              <a href="../docs/generators.html">Generators</a>
        </li>
              
    <li class="none">
              <a href="../docs/license_files.html">Licenses in resources</a>
        </li>
              
    <li class="none">
              <a href="../docs/taglibs.html">JSP Tag library</a>
        </li>
              
    <li class="none">
              <a href="../docs/plain_html.html">Use in HTML pages</a>
        </li>
              
    <li class="none">
              <a href="../docs/modes.html">Debug and production modes</a>
        </li>
              
    <li class="none">
              <a href="../docs/messages_gen.html">i18n message generator</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Integration</dt>
        <dd><ul>
              
    <li class="none">
              <strong>Add Jawr to your framework</strong>
        </li>
              
    <li class="none">
              <a href="../integration/facelets.html">Facelets Tag library</a>
        </li>
              
    <li class="none">
              <a href="../integration/grails.html">Grails plugin</a>
        </li>
              
    <li class="none">
              <a href="../integration/dwr.html">DWR</a>
        </li>
              
    <li class="none">
              <a href="../integration/validator.html">Commons Validator - Struts</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Tutorials</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../tutorials/quickstart.html">Quick start</a>
        </li>
              
    <li class="none">
              <a href="../tutorials/faq_howto.html">FAQ-Howto</a>
        </li>
              
    <li class="none">
              <a href="../tutorials/libraries.html">Using popular libraries</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>API and sources</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../nonav/apidocs/index.html">JavaDocs</a>
        </li>
              
    <li class="none">
              <a href="../nonav/xref/index.html">Source XREF</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Project tools</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Project home</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMemberList">Membership</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectNewsList">Announcements</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectForumView">Discussion forums</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMailingListList">Mailing lists</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectDocumentList">Documents & files</a>
        </li>
              
    <li class="none">
              <a href="../source/browse/jawr/">Subversion</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectIssues">Issue tracker</a>
        </li>
          </ul></dd>
    </dl>
        </div>
      <script>
        // replace the java.net project tools with the navigation bar from Maven.
        // also get rid of "Get Involved" thingie too, while we are at it
        var pt = document.getElementById("projecttools");
        var nv = document.getElementById("navcolumn");
        
        while(pt.previousSibling!=null)
          pt.parentNode.removeChild(pt.previousSibling);
        
        pt.parentNode.insertBefore(nv,pt);
        pt.parentNode.removeChild(pt);
      </script>
      <script>
        // kill "description" h3 bar
        var ld = document.getElementById("longdescription");
        if(ld!=null) {
          for( n=ld.firstChild; n!=null; n=n.nextSibling ) {
            if(n.nodeType==1 && n.innerHTML=="Description" ) {
              n.parentNode.removeChild(n);
              break;
            }
          }
        }
      </script>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Integrating Jawr in a framework</h2><p>Jawr lends itself to integrating in web frameworks of wider scope. If you have one and want to use Jawr, you probably will want your users to benefit from it instead of just using it for your framework's needs. </p><p>This means that you will probably use Jawr to bundle scripts and CSS to enhance performance. But your framework's users will probably benefit from using Jawr to bundle and compress their resources with Jawr. Better yet, they could augment the bundles that come with your framework for the tightest integration and lowest response times for pages. </p><p>In order to achieve this, Jawr has some hooks to provide multiple configuration files that augment each other. The idea behind this is that you will provide with a base configuration, which defines several standard bundles. Then you provide configuration hooks to add additional config files, in which users define their own bundles and also augment those in your framework. </p><p>Two components help in achieving this functionality: <b>ConfigPropertiesAugmenter</b> and <b>MultipleFileConfigSource</b>. The latter is a pre-cooked implementation of the ConfigPropertiesSource interface which you can extend to easily get up and running with this configuration scheme. ConfigPropertiesAugmenter is a lower level component that you can use if extending MultipleFileConfigSource does not suit your needs. </p><div class="section"><h3>Extending MultipleFileConfigSource</h3><p>This class loads a configuration file in the usual Jawr way (i.e., loads the config file specified in the configLocation init-param), and then loads further configuration files which augment the base configuration. By default, the additional configuration properties are defined as a parameter in the servlet context, under the key 'jawr.config.sources'. In the web.xml, configuration would be defined as follows: </p><div class="source"><pre>        &lt;context-param&gt;
                &lt;param-name&gt;jawr.config.sources&lt;/param-name&gt;
                &lt;param-value&gt;file:C:\jawr_A.properties,file:C:\jawr_B.properties&lt;/param-value&gt;
        &lt;/context-param&gt;</pre></div><p>Of course, this is not the best way to achieve this ends. You framework will probably have better ways to configure this parameter, so all you need to do is to extend MultipleFileConfigSource and to override the method that retrieves the parameter value, which has the following signature: </p><div class="source"><pre>        protected void initAdditionalPropertyBaseNames(ServletContext context); </pre></div><p>This method should initialize a property named 'propertyBaseNames' (which is a List object), and add to it the names of the properties files which should override the base configuration. Optionally, you can also initialize another object, this time a Set, named 'privateConfigProperties', and add all the names of properties that you don't wish to let users change or augment. </p><p>Once this is done, you only need to register your object as the ConfigPropertiesSource for Jawr, so it will be used instead of the default one. Normally it is done through the servlet configuration: </p><div class="source"><pre>                &lt;init-param&gt;
                        &lt;param-name&gt;configPropertiesSourceClass&lt;/param-name&gt;
                        &lt;param-value&gt;org.myframework.MyConfigPropertiesImplementation&lt;/param-value&gt;
                &lt;/init-param&gt;</pre></div><p>The benefit of overriding MultipleFileConfigSource is that the automatic reloading of configuration will work out of the box. Users will be able to set the time interval to check for changes in the configuration and have Jawr reload whenever changes are made. Also, the syntax to specify the location of config files remains the same as usual (using 'file:' as a prefix to load from the filesystem, or no prefix to load from the classpath). </p></div><div class="section"><h3>Using ConfigPropertiesAugmenter </h3><p>Normally, you will not need to use this class directly (being much better to override MultipleFileConfigSource), but it's important to know its behavior to understand how config augmentation works. So, read on even if you don't plan on using it. This class has two constructors: </p><div class="source"><pre>public ConfigPropertiesAugmenter(Properties configProperties);
public ConfigPropertiesAugmenter(Properties configProperties,Set privateConfigProperties);</pre></div><p>Both get the base Properties to later augment, and in the second case, a Set of 'private' config properties. This set contains names of configuration properties which will not be overwritten or augmented. For instance, if you do not wish to allow users to change the encoding of bundles (which is probably a good idea), you would add 'jawr.charset.name' to this Set. </p><p>The method which augments configuration is this one: </p><div class="source"><pre>         public void augmentConfiguration(Properties configToAdd); </pre></div><p>This method will get all properties in configToAdd and overwrite those in the base configuration, <i>except</i> for those which are augmentable. Augmentable properties will be <i>extended</i>. Take for instance a mapping property such as this: </p><div class="source"><pre>         jawr.js.bundle.one.mappings=/js/someFile.js, /js/someOtherFile.js</pre></div><p>Now, in an additional Properties file we have this mapping: </p><div class="source"><pre>         jawr.js.bundle.one.mappings=/javascript/userProvidedScript.js</pre></div><p>Well, after augmentation, the final configuration would look like this: </p><div class="source"><pre>         jawr.js.bundle.one.mappings=/js/someFile.js, /js/someOtherFile.js, /javascript/userProvidedScript.js</pre></div><p>In this example the user augments the mappings of a framework-provided bundle with his own content, thus reduceing the total number of required downloads to access his application. </p><p>The augmentable properties are the following: </p><ul><li>Bundle mappings (jawr.[type].bundle.[name].mappings). </li><li>Composite bundles child members (jawr.[type].bundle.[name].child.names).</li><li>Custom postprocessors (jawr.custom.postprocessors.names).</li><li>Generators (jawr.custom.generators). </li></ul><p>All the other properties will simply be overwritten. </p></div><div class="section"><h3>Documenting your configuration</h3><p>Once you have Jawr setup this way, the best thing you can do is to document how to use Jawr, and to specify which bundles you are using and how to augment them, in order to get the most out of Jawr usage. </p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2008
    
          
  

  
  
  &nbsp;| Last Published: 11/09/2008
  &nbsp;| Version: 2.5.1
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
